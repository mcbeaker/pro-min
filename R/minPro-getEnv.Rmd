---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(data.table)
library(stringr)
library(dplyr)
```
```{r}
pro="/home/kenneth/proj/proXtal/proteins/hagai/findgeo/FindGeoSummative_wEnvComp_reducedDuplicates.csv"
proEnv = read.table(pro, sep=",",header=TRUE)
proEnv = proEnv[proEnv$geoShort != 'irr',]
#pdb,atomNum,geoShort,geoLong,Metal_ID,Metal,resiNum,chain 
```
```{r}
min="/home/kenneth/proj/proXtal/amcsd/database/formatName/findgeo/amcsd_final_pdb/FindGeoSummative_wEnvComp_nonIrr.csv"
minEnv= read.table(min, sep=",",header=TRUE)
#pdbID,atomNum,geoShort,geoLong,metalID
#[1] "pdbID"          "atomNum"        "geoShort"       "geoLong"        "metalID"        "envComposition" "element"       
#[8] "atomName"
#Heterogenite_0014459,1,coc,octahedron face monocapped (distorted),Co_1_1_A,CO1O1H1,CO,CO
```
```{r}
N <- 1e6  # total number of rows to preallocate--possibly an overestimate

DF <- data.frame(num=rep(NA, N), txt=rep("", N),  # as many cols as you need
                 stringsAsFactors=FALSE)          # you don't know levels yet

DF = data.frame(min_ID=rep("",N),pro_ID=rep("",N),metal_ID=rep("",N),metal=rep("",N),geoShort=rep("",N),stringsAsFactors = FALSE) 

found = 1

for (proRow in 1:nrow(proEnv)){
  
  proGeoShort = toString(proEnv[proRow,"geoShort"])
  proEnv[proRow,"Metal_ID"]
  #print(toString(proGeoShort))
  minFound = minEnv[minEnv$envComposition == toString(proEnv[proRow,"Metal_ID"]) & minEnv$geoShort == toString(proEnv[proRow,"geoShort"]),]
   #minEnv %>% filter(metalID == toString(proEnv[proRow,"Metal_ID"]) & geoShort==toString(proEnv[proRow,"geoShort"])  
  #stop()                        
  if (nrow(minFound) >= 1){
    for (minRow in 1:nrow(minFound)){
      pdbID = paste(proEnv[proRow,"pdb"],proEnv[proRow,"Metal_ID"],proEnv[proRow,"geoShort"],sep="_")
    #   
      DF[found,] = list(toString(minFound[minRow,"pdbID"]),pdbID,toString(proEnv[proRow,"Metal_ID"]),toString(minFound[minRow,"element"]),toString(proEnv[proRow,"geoShort"]))
    #   
      found = found + 1
      View(DF)  
      if (found == 100){
        View(DF)
        stop()
      }
    
   }
  }                            
  
  # 
  
  
  # 
}
DF = DF %>% na.omit()
write.csv(DF,"/home/kenneth/proj/proXtal/proteins/hagai/findgeo/proMin_sameEnv.csv", row.names = FALSE)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
